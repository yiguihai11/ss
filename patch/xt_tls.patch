diff -ruN xt_tls/ipt/Makefile xt_tls2/ipt/Makefile
--- xt_tls/ipt/Makefile	2021-11-17 17:33:55.811726894 +0800
+++ xt_tls2/ipt/Makefile	2021-11-17 17:25:25.231727089 +0800
@@ -4,7 +4,7 @@
 
 all: libxt_tls.so
 lib%.so: lib%.o
-	$(CC) -shared -o $@ $^;
+	$(CC) -shared -s -o $@ $^;
 lib%.o: %lib%.c
 	$(CC) ${CFLAGS} -D_INIT=lib$*_init -c -o $@ $<;
 clean:
diff -ruN xt_tls/src/Makefile xt_tls2/src/Makefile
--- xt_tls/src/Makefile	2021-11-17 17:33:55.811726894 +0800
+++ xt_tls2/src/Makefile	2021-11-17 19:00:29.979931932 +0800
@@ -1,19 +1,23 @@
+CONFIG_MODULE_SIG=n
 obj-m += xt_tls.o
 xt_tls-objs := xt_tls_main.o hostset.o 
 KERNEL_VERSION := $(shell uname -r)
-IDIR := /lib/modules/$(KERNEL_VERSION)/kernel/net/netfilter/
-KDIR := /lib/modules/$(KERNEL_VERSION)/build
+IDIR ?= /lib/modules/$(KERNEL_VERSION)/kernel/net/netfilter/
+KDIR ?= /lib/modules/$(KERNEL_VERSION)/build
 DESTDIR ?= /
 PWD := $(shell pwd)
 VERSION := $(shell git rev-parse HEAD 2>/dev/null)
 default:
-	    $(MAKE) -C $(KDIR) SUBDIRS=$(PWD) modules
+	    $(MAKE) -C $(KDIR) M=$(PWD) modules
 
 debug:
-	    $(MAKE) -C $(KDIR) SUBDIRS=$(PWD) CFLAGS_MODULE="-DXT_TLS_DEBUG" modules
+	    $(MAKE) -C $(KDIR) M=$(PWD) CFLAGS_MODULE="-DXT_TLS_DEBUG" modules
 
 install:
-	    $(MAKE) -C $(KDIR) SUBDIRS=$(PWD) INSTALL_MOD_PATH=$(DESTDIR) modules_install
+	    $(MAKE) -C $(KDIR) M=$(PWD) INSTALL_MOD_PATH=$(DESTDIR) modules_install
+	    @echo ""
+	    @echo "SUCCESS (if you got 'SSL errors' above, you can safely ignore them)"
+	    @echo ""
 	    depmod -a
 
 clean:
diff -ruN xt_tls/src/hostset.c xt_tls2/src/hostset.c
--- xt_tls/src/hostset.c	2021-11-17 17:33:55.811726894 +0800
+++ xt_tls2/src/hostset.c	2021-11-17 17:25:25.241727089 +0800
@@ -10,6 +10,7 @@
 #include <linux/uaccess.h>
 #include <linux/seq_file.h>
 #include <asm/errno.h>
+#include <linux/version.h>
 
 #include "xt_tls.h"
 #include "hostset.h"
@@ -25,7 +26,18 @@
 // Params for displaying a hostset content and calculationg its file size
 #define HIT_COUNT_DISPL_WIDTH 12
 #define HSE_SIZE_OVERHEAD (HIT_COUNT_DISPL_WIDTH + 2)
-
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(5,6,0)
+#define HAVE_PROC_OPS
+#endif
+
+#ifdef HAVE_PROC_OPS
+static struct proc_ops proc_fops = {
+    .proc_open = seq_file_open,
+    .proc_read = seq_read,
+    .proc_write = proc_write,
+    .proc_release = seq_release,
+};
+#else
 static struct file_operations proc_fops = {
     .owner = THIS_MODULE,
     .open = seq_file_open,
@@ -33,6 +45,7 @@
     .write = proc_write,
     .release = seq_release,	
 };
+#endif
 
 // Initialize a host set
 int hs_init(struct host_set *hs, const char *name)
diff -ruN xt_tls/src/xt_tls_main.c xt_tls2/src/xt_tls_main.c
--- xt_tls/src/xt_tls_main.c	2021-11-17 17:33:55.811726894 +0800
+++ xt_tls2/src/xt_tls_main.c	2021-11-17 19:01:27.649931910 +0800
@@ -266,8 +266,8 @@
 		break;
 	}//switch
 
-#ifdef XT_TLS_DEBUG
 	printk("[xt_tls] Parsed domain: %s\n", parsed_host);
+#ifdef XT_TLS_DEBUG
 	printk("[xt_tls] Domain matches: %s, invert: %s\n", match ? "true" : "false", invert ? "true" : "false");
 #endif
 	if (invert)
